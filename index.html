<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Scripters — Premium Digital Products for Developers</title>
    <meta name="description" content="Elevate your development workflow with Scripters' premium digital products. From automation scripts to security tools, we've got you covered."/>
    <meta name="keywords" content="digital products, developer tools, scripts, automation, security tools"/>
    <meta name="author" content="Scripters Team"/>
    <meta name="robots" content="index, follow"/>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://scripters.store/"/>
    <meta property="og:title" content="Scripters — Premium Digital Products for Developers"/>
    <meta property="og:description" content="Elevate your development workflow with Scripters' premium digital products. From automation scripts to security tools, we've got you covered."/>
    <meta property="og:image" content="https://scripters.store/og-image.jpg"/>

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image"/>
    <meta property="twitter:url" content="https://scripters.store/"/>
    <meta property="twitter:title" content="Scripters — Premium Digital Products for Developers"/>
    <meta property="twitter:description" content="Elevate your development workflow with Scripters' premium digital products. From automation scripts to security tools, we've got you covered."/>
    <meta property="twitter:image" content="https://scripters.store/twitter-image.jpg"/>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png"/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        :root {
            --primary: #2B5AED;
            --primary-hover: #1E3FA3;
            --background: #0D1321;
            --card-bg: #1a1a2e;
            --text: #ffffff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text);
            background-color: var(--background);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #2B5AED, #5B8AF5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .social-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .social-link {
            color: var(--text);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .product-banner {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .product-content {
            padding: 20px;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: -50px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .product-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 15px 0 10px;
        }

        .product-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .buy-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            transition: background 0.3s ease;
        }

        .buy-button:hover:not(:disabled) {
            background: var(--primary-hover);
        }

        .buy-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .modal-message {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            margin-bottom: 15px;
        }

        .submit-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
        }

        .submit-button:hover {
            background: var(--primary-hover);
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ton-price {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .social-links {
                flex-direction: column;
                width: 100%;
            }

            .social-link {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        async function fetchProducts() {
            const response = await fetch('products.xml');
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'text/xml');
            const productElements = xml.getElementsByTagName('product');
            
            return Array.from(productElements).map(product => ({
                id: product.getElementsByTagName('id')[0].textContent,
                name: product.getElementsByTagName('name')[0].textContent,
                price: parseFloat(product.getElementsByTagName('price')[0].textContent),
                description: product.getElementsByTagName('description')[0].textContent,
                image: product.getElementsByTagName('image')[0].textContent,
                banner: product.getElementsByTagName('banner')[0].textContent,
                download: product.getElementsByTagName('download')[0].textContent,
            }));
        }

        async function fetchTONPrice() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd', {
                headers: {
                    'X-CoinGecko-API-Key': 'CG-9rG6hNGDmXXZ9DSfEY5EJHYz'
                }
            });
            const data = await response.json();
            return data['the-open-network'].usd;
        }

        function App() {
            const [products, setProducts] = useState([]);
            const [isConnected, setIsConnected] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [modalContent, setModalContent] = useState({ title: '', message: '' });
            const [tonConnect, setTonConnect] = useState(null);
            const [tonPrice, setTonPrice] = useState(null);

            useEffect(() => {
                fetchProducts().then(setProducts);
                fetchTONPrice().then(setTonPrice);

                const tc = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://raw.githubusercontent.com/Rekt-Developer/swap.scripters.shop/refs/heads/main/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect-button'
                });
                setTonConnect(tc);

                tc.onStatusChange(async (wallet) => {
                    setIsConnected(!!wallet);
                });

                // Fetch TON price every 5 minutes
                const intervalId = setInterval(() => {
                    fetchTONPrice().then(setTonPrice);
                }, 300000);

                return () => clearInterval(intervalId);
            }, []);

            const handleBuy = useCallback(async (product) => {
                if (!isConnected) {
                    setModalContent({
                        title: 'Connection Required',
                        message: 'Please connect your wallet to make a purchase.'
                    });
                    setShowModal(true);
                    return;
                }

                const amountInTON = (product.price / tonPrice).toFixed(6);
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60,
                    messages: [
                        {
                            address: "UQAYW4FbN_PFawE0K1FUqr3f2wXllR3BNhJJmrQEuIk9IERw",
                            amount: `${amountInTON * 1e9}`
                        }
                    ]
                };

                try {
                    await tonConnect.sendTransaction(transaction);
                    setModalContent({
                        title: 'Transaction Initiated',
                        message: `Transaction for $${product.price} (≈ ${amountInTON} TON) initiated! Please check your email for the product download link.`,
                        downloadLink: product.download
                    });
                    setShowModal(true);
                } catch (e) {
                    console.error("Transaction failed:", e);
                    setModalContent({
                        title: 'Transaction Failed',
                        message: 'The transaction failed. Please try again.'
                    });
                    setShowModal(true);
                }
            }, [isConnected, tonConnect, tonPrice]);

            return (
                <div className="container">
                    <header className="header">
                        <h1 className="logo">Scripters Store</h1>
                        <div className="social-links">
                            <a href="https://t.me/ScriptersCommunity" target="_blank" rel="noopener noreferrer" className="social-link">
                                <i className="fab fa-telegram"></i>
                                Join our Telegram
                            </a>
                            <div id="ton-connect-button"></div>
                        </div>
                    </header>
                    
                    <main>
                        <div className="products-grid">
                            {products.map((product) => (
                                <div key={product.id} className="product-card">
                                    <img src={product.banner} alt="" className="product-banner" />
                                    <div className="product-content">
                                        <img src={product.image} alt={product.name} className="product-image" />
                                        <h3 className="product-title">{product.name}</h3>
                                        <p className="product-description">{product.description}</p>
                                        <div className="product-price">${product.price.toFixed(2)}</div>
                                        <button 
                                            onClick={() => handleBuy(product)} 
                                            className="buy-button"
                                            disabled={!isConnected}
                                            aria-label={`Buy ${product.name}`}
                                        >
                                            {isConnected ? 'Buy Now' : 'Connect Wallet to Buy'}
                                        </button>
                                        {tonPrice && (
                                            <p className="ton-price">≈ {(product.price / tonPrice).toFixed(2)} TON</p>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    <footer>
                        <p>© 2024 Scripters Store. All rights reserved.</p>
                        {tonPrice && <p>Current TON Price: ${tonPrice.toFixed(2)}</p>}
                    </footer>

                    {showModal && (
                        <div className="modal" role="dialog" aria-modal="true">
                            <div className="modal-content">
                                <button className="close-button" onClick={() => setShowModal(false)} aria-label="Close modal">
                                    ×
                                </button>
                                <h2 className="modal-title">{modalContent.title}</h2>
                                <p className="modal-message">{modalContent.message}</p>
                                {modalContent.title === 'Transaction Initiated' && (
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const email = e.target.email.value;
                                        console.log("Email submitted:", email);
                                        window.location.href = modalContent.downloadLink;
                                        setShowModal(false);
                                    }}>
                                        <input 
                                            type="email" 
                                            id="email" 
                                            name="email" 
                                            required 
                                            placeholder="Enter your email to receive products" 
                                        />
                                        <button type="submit" className="submit-button">
                                            Download Product
                                        </button>
                                    </form>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
