<!DOCTYPE html>
<html lang="en">
<head>
    <meta charSet="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Digital Store</title>
    <meta name="description" content="Buying digital goods has never been easier than with our Digital Store. Need to purchase digital products? Visit our store now!"/>
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="Digital Goods Store"/>
    <meta property="og:description" content="Buy the digital goods you need without breaking the bank or breaking a sweat!"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Digital Goods Store"/>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: white;
            background-color: #0D1321;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .product-card {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        .buy-button {
            background: #29d;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .buy-button:hover {
            background: #007acc;
        }
        .buy-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px 0;
            background: #1a1a2e;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #1a1a2e;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 100%;
        }
        .close-button {
            float: right;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        const products = [
            { id: 1, name: "Premium eBook", price: 250.00, image: "https://via.placeholder.com/250?text=Premium+eBook" },
            { id: 2, name: "Online Course", price: 100.00, image: "https://via.placeholder.com/250?text=Online+Course" },
            { id: 3, name: "Software License", price: 300.00, image: "https://via.placeholder.com/250?text=Software+License" },
            { id: 4, name: "Digital Art", price: 400.00, image: "https://via.placeholder.com/250?text=Digital+Art" },
            { id: 5, name: "Music Album", price: 150.00, image: "https://via.placeholder.com/250?text=Music+Album" }
        ];

        const tonToUSD = 2.00;

        function App() {
            const [isConnected, setIsConnected] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [modalContent, setModalContent] = useState({ title: '', message: '' });
            const [tonConnect, setTonConnect] = useState(null);

            useEffect(() => {
                const tc = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://raw.githubusercontent.com/Rekt-Developer/swap.scripters.shop/refs/heads/main/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect-button'
                });
                setTonConnect(tc);

                tc.onStatusChange(async (wallet) => {
                    setIsConnected(!!wallet);
                });
            }, []);

            const handleBuy = useCallback(async (product) => {
                if (!isConnected) {
                    setModalContent({
                        title: 'Connection Required',
                        message: 'Please connect your wallet to make a purchase.'
                    });
                    setShowModal(true);
                    return;
                }

                const amountInTON = (product.price / tonToUSD).toFixed(6);
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60,
                    messages: [
                        {
                            address: "UQAYW4FbN_PFawE0K1FUqr3f2wXllR3BNhJJmrQEuIk9IERw",
                            amount: `${amountInTON * 1e9}`
                        }
                    ]
                };

                try {
                    await tonConnect.sendTransaction(transaction);
                    setModalContent({
                        title: 'Transaction Initiated',
                        message: `Transaction for $${product.price} (â‰ˆ ${amountInTON} TON) initiated! Please check your email for the product and contact us on Telegram.`
                    });
                    setShowModal(true);
                } catch (e) {
                    console.error("Transaction failed:", e);
                    setModalContent({
                        title: 'Transaction Failed',
                        message: 'The transaction failed. Please try again.'
                    });
                    setShowModal(true);
                }
            }, [isConnected, tonConnect]);

            return (
                <div className="container">
                    <header className="header">
                        <h1>Digital Store</h1>
                        <div id="ton-connect-button"></div>
                    </header>
                    <main>
                        <h2>Available Products</h2>
                        <div className="products-grid">
                            {products.map((product) => (
                                <div key={product.id} className="product-card">
                                    <img src={product.image} alt={product.name} className="product-image" />
                                    <h3>{product.name}</h3>
                                    <p>${product.price.toFixed(2)}</p>
                                    <button 
                                        onClick={() => handleBuy(product)} 
                                        className="buy-button"
                                        disabled={!isConnected}
                                        aria-label={`Buy ${product.name}`}
                                    >
                                        Buy Now
                                    </button>
                                </div>
                            ))}
                        </div>
                    </main>
                    <footer>
                        <p>&copy; 2023 Digital Store. All rights reserved.</p>
                    </footer>
                    {showModal && (
                        <div className="modal" role="dialog" aria-modal="true">
                            <div className="modal-content">
                                <button className="close-button" onClick={() => setShowModal(false)} aria-label="Close modal">
                                    &times;
                                </button>
                                <h2>{modalContent.title}</h2>
                                <p>{modalContent.message}</p>
                                {modalContent.title === 'Transaction Initiated' && (
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const email = e.target.email.value;
                                        // Here you would typically send this email to your server
                                        console.log("Email submitted:", email);
                                        setShowModal(false);
                                    }}>
                                        <label htmlFor="email">
                                            <span className="sr-only">Enter your email:</span>
                                            <input type="email" id="email" name="email" required placeholder="Enter your email" />
                                        </label>
                                        <button type="submit">Submit</button>
                                    </form>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
